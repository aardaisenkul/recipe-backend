[build]
builder = "nixpacks"
buildCommand = "npm run build"

[deploy]
startCommand = "npm run start"
healthcheckPath = "/"
healthcheckTimeout = 300

[deploy.migrations]
command = "node -e \"require('pg').Pool({ connectionString: process.env.DATABASE_URL, ssl: { rejectUnauthorized: false } }).query(require('fs').readFileSync('src/db/schema.sql', 'utf8')).then(() => process.exit(0)).catch(e => { console.error(e); process.exit(1); });\"" 